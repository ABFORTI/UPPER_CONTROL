sequenceDiagram
    actor User
    participant Browser
    participant DashboardController
    participant DB
    participant Excel
    participant Export
    participant Storage

    User->>Browser: Click "Exportar OTs"
    Browser->>DashboardController: GET /dashboard/export/ots
    
    DashboardController->>DashboardController: Check user permissions
    
    DashboardController->>DB: Query ordenes según rol
    
    alt Admin/Coordinador
        DB-->>DashboardController: Todas las OTs
    else Team Leader
        DB-->>DashboardController: Solo OTs asignadas
    else Cliente
        DB-->>DashboardController: Solo OTs de sus solicitudes
    end
    
    DashboardController->>Export: new OtExport(ordenes)
    Export->>Export: collection() - Preparar datos
    
    loop Para cada orden
        Export->>Export: Formatear:<br/>- ID, Folio<br/>- Cliente<br/>- Estado<br/>- Progreso<br/>- Fechas
    end
    
    DashboardController->>Excel: Excel::download(export, 'ots.xlsx')
    Excel->>Excel: Generar archivo Excel
    Excel->>Storage: Crear archivo temporal
    Storage-->>Excel: File path
    
    Excel-->>DashboardController: Excel file
    DashboardController-->>Browser: Download response
    Browser-->>User: Descarga ots.xlsx
    
    Note over User: Archivo Excel descargado<br/>con todas las OTs filtradas
    
    User->>Browser: Click "Exportar Facturas"
    Browser->>DashboardController: GET /dashboard/export/facturas
    
    DashboardController->>DB: Query facturas según rol
    DB-->>DashboardController: Facturas permitidas
    
    DashboardController->>Export: new FacturaExport(facturas)
    Export->>Export: collection() - Preparar datos
    
    loop Para cada factura
        Export->>Export: Formatear:<br/>- ID, Folio<br/>- OT<br/>- Total<br/>- Estado<br/>- Fechas
    end
    
    DashboardController->>Excel: Excel::download(export, 'facturas.xlsx')
    Excel->>Excel: Generar archivo
    Excel-->>DashboardController: Excel file
    DashboardController-->>Browser: Download
    Browser-->>User: Descarga facturas.xlsx
