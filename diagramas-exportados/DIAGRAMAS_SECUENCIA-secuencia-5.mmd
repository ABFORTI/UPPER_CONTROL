sequenceDiagram
    actor Cliente
    participant Email
    participant Browser
    participant ClienteController
    participant Orden
    participant DB
    participant Notification
    actor Facturacion

    Note over Cliente: Recibe email de<br/>OT validada por calidad
    
    Cliente->>Email: Lee email con link
    Email->>Browser: Click en link /ordenes/{id}
    Browser->>Browser: Login (si no autenticado)
    
    Browser->>ClienteController: GET show(orden)
    ClienteController->>DB: Cargar orden completa
    DB-->>ClienteController: Orden con todos los detalles
    ClienteController-->>Browser: Render vista
    Browser-->>Cliente: Mostrar OT para revisión
    
    Cliente->>Cliente: Revisa:<br/>- Conceptos<br/>- Cantidades<br/>- Precios<br/>- Evidencias
    
    alt Cliente Autoriza
        Cliente->>Browser: Click "Autorizar OT"
        Browser->>ClienteController: POST autorizar(orden)
        
        ClienteController->>ClienteController: Verificar estado = 'validada_calidad'
        
        ClienteController->>Orden: Update estado = 'validada_cliente'
        Orden->>DB: UPDATE orden
        
        ClienteController->>Notification: ClienteAutorizoNotification
        Notification->>Facturacion: 📧 Email a facturación
        Notification->>DB: Guardar notificación
        
        ClienteController-->>Browser: Success
        Browser-->>Cliente: "OT autorizada para facturación"
        
        Note over Facturacion: Recibe notificación<br/>OT lista para facturar
    else Cliente No Autoriza
        Cliente->>Browser: No hace nada o contacta
        
        Note over Cliente: OT se queda en estado<br/>'validada_calidad'<br/>esperando autorización
    end
