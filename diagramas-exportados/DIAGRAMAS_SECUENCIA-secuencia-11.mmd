sequenceDiagram
    participant Scheduler
    participant Backup
    participant DB
    participant Storage
    participant Zip
    participant Notification
    participant Mail
    actor Admin

    Note over Scheduler: Cron ejecuta diariamente

    Scheduler->>Backup: spatie/backup run
    Backup->>Backup: Configurar backup
    
    Backup->>DB: Dump MySQL database
    DB-->>Backup: SQL dump file
    
    Backup->>Storage: Backup storage/app files
    Storage-->>Backup: Files copied
    
    Backup->>Zip: Comprimir backup
    Zip->>Zip: Create .zip file
    Zip-->>Backup: Backup file created
    
    alt Backup exitoso
        Backup->>Storage: Guardar en storage/app/backups
        Storage-->>Backup: Saved
        
        Backup->>Notification: NotifyBackupOk
        Notification->>Mail: Email a admins
        Mail->>Admin: 📧 "Backup exitoso"
        Notification->>DB: Log notification
        
        Backup-->>Scheduler: Success
    else Backup falló
        Backup->>Notification: NotifyBackupFailed
        Notification->>Mail: Email urgente a admins
        Mail->>Admin: 🚨 "Backup FALLÓ"
        Notification->>DB: Log error
        
        Backup-->>Scheduler: Failed
    end
    
    Note over Admin: Recibe notificación<br/>del estado del backup
    
    Admin->>Browser: Accede a /admin/backups
    Browser->>BackupController: GET index()
    BackupController->>Storage: List backup files
    Storage-->>BackupController: Lista archivos
    BackupController-->>Browser: Render lista
    Browser-->>Admin: Mostrar backups disponibles
    
    Admin->>Browser: Click "Descargar backup"
    Browser->>BackupController: GET download?file=...
    BackupController->>Storage: Read backup file
    Storage-->>BackupController: File binary
    BackupController-->>Browser: Download response
    Browser-->>Admin: Descarga backup.zip
    
    Note over Admin: Backup descargado<br/>para resguardo externo
